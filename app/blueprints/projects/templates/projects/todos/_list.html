<!-- Debug comment to verify template inclusion -->
<div class="table-responsive">
  <table class="table table-hover align-middle">
    <thead>
      <tr>
        <th style="width: 10px">#</th>
        <th>Description</th>
        <th style="width: 100px">Due</th>
        {% if not readonly %}
        <th style="width: 100px">Actions</th>
        {% endif %}
      </tr>
    </thead>
    <tbody id="todoList">
      {% set todos = task.todos if task is defined else (project.todos if project is defined and project.todos else []) %}
      {% if todos %}
        {% for todo in todos %}
        <tr data-todo-id="{{ todo.id }}">
          <td class="text-center">
            <div class="form-check">
              <input type="checkbox" class="form-check-input todo-checkbox" 
                     id="todoCheck{{ todo.id }}" 
                     name="todos[{{ loop.index0 }}][completed]"
                     {% if todo.completed %}checked{% endif %}
                     {% if readonly %}disabled{% endif %}>
              <label class="form-check-label" for="todoCheck{{ todo.id }}"></label>
              <input type="hidden" class="todo-id" name="todos[{{ loop.index0 }}][id]" value="{{ todo.id }}">
            </div>
          </td>
          <td>
            <span class="todo-text {% if todo.completed %}text-muted text-decoration-line-through{% endif %}">
              {{ todo.description }}
            </span>
          </td>
          <td>
            {% if todo.due_date %}
            <span class="badge bg-info due-date-badge">
              <i class="far fa-clock me-1"></i>{{ todo.due_date.strftime('%Y-%m-%d') }}
            </span>
            {% endif %}
          </td>
          {% if not readonly %}
          <td class="text-center">
            <button type="button" class="btn btn-primary btn-sm edit-todo me-1" onclick="todoModule.editTodo({{ todo.id }})" title="Edit Todo">
              <i class="fas fa-edit"></i>
            </button>
            <button type="button" class="btn btn-danger btn-sm remove-todo" onclick="todoModule.deleteTodo({{ todo.id }})" title="Remove Todo">
              <i class="fas fa-trash"></i>
            </button>
          </td>
          {% endif %}
        </tr>
        {% endfor %}
      {% endif %}
      {% if not todos or todos|length == 0 %}
      <tr>
        <td colspan="{% if readonly %}3{% else %}4{% endif %}" class="text-center text-muted">
          No todo items found.
        </td>
      </tr>
      {% endif %}
      {% if not readonly %}
      <tr id="newTodoRow" class="d-none">
        <td class="text-center">
          <div class="form-check">
            <input type="checkbox" class="form-check-input" disabled>
          </div>
        </td>
        <td>
          <input type="text" class="form-control form-control-sm" id="todo-description" placeholder="Enter todo description" required>
        </td>
        <td>
          <input type="date" class="form-control form-control-sm" id="todo-due-date">
        </td>
        <td class="text-center">
          <button type="button" class="btn btn-success btn-sm" id="saveTodoBtn" onclick="todoModule.createTodo()" title="Save Todo">
            <i class="fas fa-check"></i>
          </button>
          <button type="button" class="btn btn-secondary btn-sm" id="cancelTodoBtn" onclick="todoModule.hideNewTodoForm()" title="Cancel">
            <i class="fas fa-times"></i>
          </button>
        </td>
      </tr>
      {% endif %}
    </tbody>
  </table>
</div>

{% if not readonly %}
<div class="card-footer text-end bg-transparent">
  <button type="button" class="btn btn-primary btn-sm" id="addTodoBtn" onclick="todoModule.showNewTodoForm()">
    <i class="fas fa-plus me-1"></i>Add Todo
  </button>
</div>
{% endif %}

<style>
/* Theme-aware table styles */
.table {
  --bs-table-color: var(--bs-body-color);
  --bs-table-bg: var(--bs-body-bg);
  --bs-table-border-color: var(--bs-border-color);
  --bs-table-hover-bg: var(--bs-secondary-bg);
  --bs-table-hover-color: var(--bs-body-color);
}

/* Form control theme support */
.form-control {
  background-color: var(--bs-body-bg);
  border-color: var(--bs-border-color);
  color: var(--bs-body-color);
}

.form-control:focus {
  background-color: var(--bs-body-bg);
  border-color: var(--bs-primary);
  color: var(--bs-body-color);
  box-shadow: 0 0 0 0.2rem rgba(var(--bs-primary-rgb), 0.25);
}

/* Todo item styling */
.todo-description.text-muted {
  opacity: 0.65;
}

.todo-text {
  display: block;
  padding: 0.25rem 0;
}

/* Badge styling */
.due-date-badge {
  font-size: 0.85em;
  padding: 0.35em 0.65em;
  font-weight: 500;
}

/* Checkbox styling */
.form-check {
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 1.5rem;
}

.form-check-input {
  margin: 0;
}

/* Card footer styling */
.card-footer {
  border-top: 1px solid var(--bs-border-color);
  padding: 0.75rem 1.25rem;
}
</style>
