<!-- Sub Task Modal -->
<div class="modal fade" id="subtaskModal" tabindex="-1" aria-labelledby="subtaskModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content bg-dark text-light">
      <div class="modal-header">
        <h5 class="modal-title" id="subtaskModalLabel">
          <i class="fas fa-tasks me-1"></i>
          <span id="modalTitle">Sub Task Details</span>
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="subtaskForm">
          <div class="row">
            <!-- Left Column (8 columns) -->
            <div class="col-md-8">
              <!-- Sub Task Details Card -->
              <div class="card bg-dark mb-4">
                <div class="card-header">
                  <h5 class="card-title mb-0">
                    <i class="fas fa-info-circle me-1"></i>
                    Sub Task Details
                  </h5>
                </div>
                <div class="card-body">
                  <!-- Name -->
                  <div class="form-group mb-3">
                    <label for="subtask-name" class="form-label">Name</label>
                    <input type="text" class="form-control bg-dark text-light border-secondary" 
                           id="subtask-name" name="name" required 
                           {% if readonly %}readonly{% endif %}>
                  </div>

                  <!-- Summary -->
                  <div class="form-group mb-3">
                    <label for="subtask-summary" class="form-label">Summary</label>
                    <input type="text" class="form-control bg-dark text-light border-secondary" 
                           id="subtask-summary" name="summary" 
                           {% if readonly %}readonly{% endif %}>
                  </div>

                  <!-- Description -->
                  <div class="form-group mb-3">
                    <label for="subtask-description" class="form-label">Description</label>
                    <textarea class="form-control bg-dark text-light border-secondary rich-text-editor" 
                              id="subtask-description" name="description" rows="5" 
                              {% if readonly %}readonly{% endif %}></textarea>
                  </div>
                </div>
              </div>

              <!-- Comments Card -->
              <div class="card bg-dark mb-4">
                <div class="card-header">
                  <h5 class="card-title mb-0">
                    <i class="fas fa-comments me-1"></i>
                    Comments
                  </h5>
                </div>
                <div class="card-body">
                  <div class="direct-chat-messages" id="subtaskCommentsList">
                    <!-- Comments will be dynamically loaded here -->
                  </div>
                  {% if not readonly %}
                  <div class="input-group mt-3">
                    <input type="text" class="form-control bg-dark text-light border-secondary" 
                           id="subtaskCommentInput" placeholder="Type your comment...">
                    <button class="btn btn-primary" type="button" onclick="addSubtaskComment()">
                      <i class="fas fa-paper-plane"></i>
                    </button>
                  </div>
                  {% endif %}
                </div>
              </div>

              <!-- History Card -->
              <div class="card bg-dark">
                <div class="card-header">
                  <h5 class="card-title mb-0">
                    <i class="fas fa-history me-1"></i>
                    Sub Task History
                  </h5>
                </div>
                <div class="card-body p-0">
                  <div class="table-responsive">
                    <table class="table table-hover table-dark mb-0">
                      <thead>
                        <tr>
                          <th>Date</th>
                          <th>User</th>
                          <th>Action</th>
                          <th>Details</th>
                        </tr>
                      </thead>
                      <tbody id="subtaskHistoryList">
                        <!-- History items will be dynamically loaded here -->
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <!-- Right Column (4 columns) -->
            <div class="col-md-4">
              <!-- Sub Task Info Card -->
              <div class="card bg-dark mb-4">
                <div class="card-header">
                  <h5 class="card-title mb-0">
                    <i class="fas fa-info-circle me-1"></i>
                    Sub Task Information
                  </h5>
                </div>
                <div class="card-body">
                  <!-- Status -->
                  <div class="form-group mb-3">
                    <label for="subtask-status" class="form-label">
                      <i class="fas fa-tasks me-1"></i>
                      Status
                    </label>
                    <select class="form-select bg-dark text-light border-secondary" id="subtask-status" name="status" 
                            {% if readonly %}disabled{% endif %}>
                      <option value="">Select Status</option>
                      <!-- Status options will be dynamically loaded -->
                    </select>
                  </div>

                  <!-- Priority -->
                  <div class="form-group mb-3">
                    <label for="subtask-priority" class="form-label">
                      <i class="fas fa-flag me-1"></i>
                      Priority
                    </label>
                    <select class="form-select bg-dark text-light border-secondary" id="subtask-priority" name="priority" 
                            {% if readonly %}disabled{% endif %}>
                      <option value="">Select Priority</option>
                      <!-- Priority options will be dynamically loaded -->
                    </select>
                  </div>

                  <!-- Lead -->
                  <div class="form-group mb-3">
                    <label for="subtask-assigned" class="form-label">
                      <i class="fas fa-user me-1"></i>
                      Lead
                    </label>
                    <select class="form-select bg-dark text-light border-secondary" id="subtask-assigned" name="assigned_to_id" 
                            {% if readonly %}disabled{% endif %}>
                      <option value="">Select User</option>
                      <!-- User options will be dynamically loaded -->
                    </select>
                  </div>

                  <!-- Due Date -->
                  <div class="form-group mb-3">
                    <label for="subtask-due-date" class="form-label">
                      <i class="fas fa-calendar me-1"></i>
                      Due Date
                    </label>
                    <input type="date" class="form-control bg-dark text-light border-secondary" 
                           id="subtask-due-date" name="due_date" 
                           {% if readonly %}readonly{% endif %}>
                  </div>

                  <!-- Created At -->
                  <div class="form-group mb-3 created-at-field" style="display: none;">
                    <label class="form-label">
                      <i class="fas fa-clock me-1"></i>
                      Created
                    </label>
                    <div class="text-muted" id="subtask-created-at"></div>
                  </div>

                  <!-- Updated At -->
                  <div class="form-group mb-3 updated-at-field" style="display: none;">
                    <label class="form-label">
                      <i class="fas fa-clock me-1"></i>
                      Last Updated
                    </label>
                    <div class="text-muted" id="subtask-updated-at"></div>
                  </div>
                </div>
              </div>

              <!-- Save Button -->
              {% if not readonly %}
              <button type="submit" class="btn btn-primary btn-lg w-100">
                <i class="fas fa-save me-1"></i>
                Save Changes
              </button>
              {% endif %}
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<style>
/* Style for status and priority dropdowns */
#subtask-status option,
#subtask-priority option {
    background-color: var(--bs-dark);
    color: var(--bs-light);
}

/* Style for selected status and priority */
#subtask-status[data-selected="true"],
#subtask-priority[data-selected="true"] {
    color: white !important;
}

/* Style for date input */
input[type="date"]::-webkit-calendar-picker-indicator {
    filter: invert(1);
}

/* Style for TinyMCE in dark mode */
.tox.tox-tinymce {
    border-color: rgba(255, 255, 255, 0.2) !important;
}
.tox .tox-edit-area__iframe {
    background-color: var(--bs-dark) !important;
    color: var(--bs-light) !important;
}
</style>
