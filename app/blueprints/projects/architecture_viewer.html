<!DOCTYPE html>
<html>
<head>
    <title>Projects Plugin Architecture</title>
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        pre {
            background-color: #f6f8fa;
            padding: 16px;
            border-radius: 6px;
            overflow: auto;
        }
        code {
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
        }
        h1, h2, h3 {
            border-bottom: 1px solid #eaecef;
            padding-bottom: .3em;
            color: #24292e;
        }
        .mermaid {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        #content {
            background-color: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div id="content"></div>

    <script>
        // Initialize mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            er: {
                useMaxWidth: true
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        // Markdown content
        const markdownContent = `# Projects Plugin Architecture

This document provides a comprehensive overview of the Projects plugin architecture, functionality, and relationships.

## Overview

The Projects plugin is a powerful task management system that supports:
- Project management with hierarchical tasks
- Todo items for both projects and tasks
- Status and priority management
- User roles and permissions
- Activity tracking and history
- Comments and notifications
- Flexible assignment capabilities

## Entity Relationship Diagram

<div class="mermaid">
erDiagram
    Project ||--|{ Task : "contains"
    Project ||--|{ Todo : "contains"
    Project ||--|{ Comment : "has"
    Project ||--|{ History : "tracks"
    Project ||--|| User : "led by"
    Project }|--|{ User : "watched by"
    Project }|--|{ User : "stakeholders"
    Project }|--|{ User : "shareholders"
    Project }|--|{ Role : "has"
    Task ||--|{ Task : "parent of"
    Task ||--|{ Todo : "contains"
    Task ||--|{ Comment : "has"
    Task ||--|{ History : "tracks"
    Task ||--|| User : "assigned to"
    Task ||--|| ProjectStatus : "has"
    Task ||--|| ProjectPriority : "has"
    Todo ||--|| User : "assigned to"
    Comment ||--|| User : "created by"
    History ||--|| User : "created by"
</div>

## Project Workflow States

<div class="mermaid">
stateDiagram-v2
    [*] --> Planning
    Planning --> Active
    Active --> OnHold
    Active --> Completed
    OnHold --> Active
    Completed --> Archived
    Active --> Archived
    OnHold --> Archived
</div>

## Task Management Structure

<div class="mermaid">
flowchart TD
    Project --> Task1["Task 1"]
    Project --> Task2["Task 2"]
    Task1 --> Subtask1["Subtask 1"]
    Task1 --> Subtask2["Subtask 2"]
    Task2 --> Subtask3["Subtask 3"]
    Task1 --> Todo1["Todo Item 1"]
    Task1 --> Todo2["Todo Item 2"]
    Subtask1 --> Todo3["Todo Item 3"]
    Project --> ProjectTodo1["Project Todo 1"]
    Project --> ProjectTodo2["Project Todo 2"]
</div>

## Core Components

### Project Model
- Central entity for organizing work
- Supports private/public visibility
- Configurable notification settings
- Tracks completion percentage
- Maintains activity history

### Task Model
- Hierarchical structure supporting subtasks
- Status and priority tracking
- Due date management
- Assignment capabilities
- Comment thread support

### Todo Model
- Checklist functionality for both projects and tasks
- Due date tracking
- Assignment capabilities
- Order management for prioritization

### Comment System
- Threaded discussions on projects and tasks
- User attribution
- Timestamp tracking
- Avatar support

### History Tracking
- Comprehensive change logging
- Action categorization (created, updated, deleted, etc.)
- JSON-based detail storage
- User attribution

## User Roles and Relationships

### Project Roles
1. **Lead**: Primary project manager
2. **Watchers**: Users following project updates
3. **Stakeholders**: Key decision makers
4. **Shareholders**: Extended team members

### Access Control
- Private/Public project visibility
- Role-based access control
- Granular notification settings

## Status and Priority Management

### Status Configuration
- Customizable status definitions
- Color coding support
- Progress tracking

### Priority Levels
- Configurable priority levels
- Visual indicators
- Impact on task organization

## Notification System

The plugin supports configurable notifications for:
- Task creation
- Task completion
- Comment activity
- Status changes
- Assignment updates

## Technical Implementation

### Database Schema
- Leverages SQLAlchemy ORM
- Implements proper foreign key relationships
- Supports cascading deletions
- Maintains data integrity

### API Structure
- RESTful endpoints
- JSON response formatting
- Proper error handling
- Activity logging

### Frontend Integration
- Bootstrap styling support
- Dynamic UI updates
- Real-time status indicators
- Interactive task management

## Future Improvements

1. **Enhanced Reporting**
   - Burndown charts
   - Velocity tracking
   - Time estimation

2. **Advanced Features**
   - File attachments
   - Time tracking
   - Custom fields
   - Template support

3. **Integration Capabilities**
   - Calendar sync
   - Email integration
   - API webhooks
   - External tool connections

This document will be continuously updated as new features and improvements are added to the Projects plugin.`;

        // Render the markdown
        document.getElementById('content').innerHTML = marked.parse(markdownContent);
        
        // Re-run mermaid
        mermaid.init();
    </script>
</body>
</html>
