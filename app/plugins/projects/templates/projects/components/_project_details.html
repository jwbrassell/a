<!-- Project Details Card -->
<div class="card mb-4">
    <div class="card-header" role="button" data-bs-toggle="collapse" data-bs-target="#projectDetailsCollapse" aria-expanded="true" aria-controls="projectDetailsCollapse">
        <div class="d-flex justify-content-between align-items-center">
            <h3 class="card-title mb-0">Project Details</h3>
            <i class="fas fa-minus project-details-collapse-icon"></i>
        </div>
    </div>
    <div class="collapse show" id="projectDetailsCollapse">
        <div class="card-body">
            <!-- Project Name -->
            <div class="mb-4">
                <div class="row align-items-center">
                    <div class="col-3">
                        <label for="project-name" class="mb-0">Project Name</label>
                    </div>
                    <div class="col-9">
                        <input type="text" class="form-control" id="project-name" name="name" 
                               value="{{ project.name }}" placeholder="Enter project name"
                               {% if readonly %}readonly{% endif %}>
                    </div>
                </div>
            </div>

            <!-- Project Summary -->
            <div class="mb-4">
                <div class="row align-items-center">
                    <div class="col-3">
                        <label for="project-summary" class="mb-0">Summary</label>
                    </div>
                    <div class="col-9">
                        <input type="text" class="form-control" id="project-summary" name="summary" 
                               value="{{ project.summary }}" placeholder="Brief project description"
                               {% if readonly %}readonly{% endif %}>
                    </div>
                </div>
            </div>

            <!-- Project Description -->
            <div class="mb-4">
                <label for="project-description">Description</label>
                <div class="description-container">
                    {% if readonly %}
                    <div class="rich-text-content description-preview" id="description-preview">
                        {{ project.description|safe }}
                    </div>
                    <button type="button" class="btn btn-link btn-sm expand-description" onclick="toggleDescription(this)">
                        Show More
                    </button>
                    {% else %}
                    <textarea class="form-control rich-text-editor" id="project-description" name="description">{{ project.description }}</textarea>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Description container styles */
.description-container {
    position: relative;
}

.description-preview {
    max-height: 4.8em; /* Approximately 3 lines */
    overflow: hidden;
    transition: max-height 0.3s ease;
    position: relative;
}

.description-preview.expanded {
    max-height: none;
    overflow: visible;
}

.description-preview:not(.expanded)::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 20px;
    background: linear-gradient(transparent, var(--bs-body-bg));
    pointer-events: none;
}

.expand-description {
    position: relative;
    padding: 0;
    font-size: 0.875rem;
    text-decoration: none;
    margin-top: 0.5rem;
    display: none;
}

/* Rich text editor styles */
.tox.tox-tinymce {
    border-radius: 0.375rem;
    border-color: var(--bs-border-color);
}

.tox .tox-toolbar,
.tox .tox-toolbar__overflow,
.tox .tox-toolbar__primary {
    background: var(--bs-body-bg) !important;
    border-bottom: 1px solid var(--bs-border-color);
}

.tox .tox-tbtn {
    color: var(--bs-body-color) !important;
}

.tox .tox-tbtn:hover {
    background: var(--bs-secondary-bg) !important;
}

[data-bs-theme="dark"] .tox.tox-tinymce {
    border-color: var(--bs-border-color-translucent);
    background: var(--bs-dark) !important;
}

[data-bs-theme="dark"] .tox .tox-toolbar,
[data-bs-theme="dark"] .tox .tox-toolbar__overflow,
[data-bs-theme="dark"] .tox .tox-toolbar__primary {
    background: var(--bs-dark) !important;
    border-color: var(--bs-border-color-translucent);
}

[data-bs-theme="dark"] .tox .tox-tbtn svg {
    fill: var(--bs-body-color) !important;
}

[data-bs-theme="dark"] .tox .tox-tbtn:hover {
    background: var(--bs-secondary-bg) !important;
}

.rich-text-content {
    font-size: 0.95rem;
    line-height: 1.6;
}

.rich-text-content p {
    margin-bottom: 0.75rem;
}

.rich-text-content p:last-child {
    margin-bottom: 0;
}

.rich-text-content img {
    max-width: 100%;
    height: auto;
    border-radius: 4px;
    margin: 0.5rem 0;
}

.rich-text-content ul,
.rich-text-content ol {
    margin-bottom: 0.75rem;
    padding-left: 1.5rem;
}

[data-bs-theme="dark"] .description-preview:not(.expanded)::after {
    background: linear-gradient(transparent, var(--bs-dark));
}
</style>

<script>
function toggleDescription(button) {
    const preview = document.querySelector('.description-preview');
    const isExpanded = preview.classList.contains('expanded');
    
    preview.classList.toggle('expanded');
    button.textContent = isExpanded ? 'Show More' : 'Show Less';
}

document.addEventListener('DOMContentLoaded', function() {
    const projectDetailsCollapse = document.getElementById('projectDetailsCollapse');
    const collapseIcon = document.querySelector('.project-details-collapse-icon');
    
    projectDetailsCollapse.addEventListener('show.bs.collapse', function() {
        collapseIcon.classList.remove('fa-plus');
        collapseIcon.classList.add('fa-minus');
    });
    
    projectDetailsCollapse.addEventListener('hide.bs.collapse', function() {
        collapseIcon.classList.remove('fa-minus');
        collapseIcon.classList.add('fa-plus');
    });

    // Check if description needs expand button
    const preview = document.querySelector('.description-preview');
    if (preview && preview.scrollHeight > preview.clientHeight) {
        const expandButton = document.querySelector('.expand-description');
        if (expandButton) {
            expandButton.style.display = 'block';
        }
    }
});
</script>
