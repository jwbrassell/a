{% extends 'projects/layouts/_two_column.html' %}

{% block title %}{{ project.name }}{% endblock %}

{% block styles %}
{{ super() }}
<style>
.form-control:disabled, 
.form-control[readonly],
.form-select:disabled {
    background-color: transparent;
    border: none;
    padding-left: 0;
    cursor: default;
}
.input-group-text {
    background-color: transparent;
    border: none;
}
.input-group .btn {
    display: none;
}
textarea.form-control[readonly] {
    min-height: unset;
    height: auto;
}
.todo-list {
    min-height: unset;
}
.todo-item {
    padding: 8px;
    margin: 4px 0;
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 4px;
}
.history-table th {
    background: #f8f9fa;
}
.direct-chat-messages {
    height: 400px;
    overflow-y: auto;
}
.direct-chat-text {
    margin: 5px 0 0 10px;
}
/* Rich text content styling */
.rich-text-content {
    line-height: 1.6;
}
.rich-text-content p {
    margin-bottom: 1rem;
}
.rich-text-content ul, 
.rich-text-content ol {
    margin-bottom: 1rem;
    padding-left: 2rem;
}
.rich-text-content img {
    max-width: 100%;
    height: auto;
}
.rich-text-content table {
    width: 100%;
    margin-bottom: 1rem;
    border-collapse: collapse;
}
.rich-text-content table td,
.rich-text-content table th {
    padding: 0.5rem;
    border: 1px solid #dee2e6;
}
.card-tools {
    float: right;
}
.btn-tool {
    background: transparent;
    color: #adb5bd;
    font-size: 0.875rem;
    margin: -0.75rem 0;
    padding: .25rem .5rem;
}
.btn-tool:hover {
    color: #495057;
}
.card-header[data-bs-toggle="collapse"] {
    cursor: pointer;
}
</style>
{% endblock %}

{% block header %}
    {% include 'projects/components/_project_header.html' %}
{% endblock %}

{% block left_column %}
    <!-- Project Details -->
    {% with readonly=True %}
    {% include 'projects/components/_project_details.html' %}
    {% endwith %}

    <!-- Tasks Table -->
    <div class="card mb-4">
        <div class="card-header" data-bs-toggle="collapse" data-bs-target="#tasks-collapse">
            <div class="d-flex justify-content-between align-items-center">
                <h3 class="card-title mb-0">
                    <i class="fas fa-tasks me-1"></i>
                    Tasks
                </h3>
                <button type="button" class="btn btn-tool">
                    <i class="fas fa-minus collapse-icon"></i>
                </button>
            </div>
        </div>
        <div id="tasks-collapse" class="collapse show">
            <div class="card-body">
                {% include 'projects/tasks/_table.html' %}
            </div>
        </div>
    </div>

    <!-- Todo List -->
    <div class="card mb-4">
        <div class="card-header" data-bs-toggle="collapse" data-bs-target="#todos-collapse">
            <div class="d-flex justify-content-between align-items-center">
                <h3 class="card-title mb-0">
                    <i class="fas fa-check-square me-1"></i>
                    Todo List
                </h3>
                <button type="button" class="btn btn-tool">
                    <i class="fas fa-minus todos-collapse-icon"></i>
                </button>
            </div>
        </div>
        <div id="todos-collapse" class="collapse show">
            <div class="card-body p-0">
                {% include 'projects/todos/_list.html' %}
            </div>
        </div>
    </div>

    <!-- Comments Section -->
    <div class="card mb-4">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-comments me-1"></i>
                Comments
            </h3>
        </div>
        <div class="card-body">
            {% include 'projects/comments/_list.html' %}
        </div>
    </div>

    <!-- History Table -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-history me-1"></i>
                Project History
            </h3>
        </div>
        <div class="card-body">
            {% include 'projects/history/_list.html' %}
        </div>
    </div>
{% endblock %}

{% block right_column %}
    <!-- Project Info -->
    {% with readonly=True %}
    {% include 'projects/components/_project_info.html' %}
    {% endwith %}

    <!-- Team Members -->
    <div class="card mb-4">
        <div class="card-header">
            <h3 class="card-title">Team Members</h3>
        </div>
        <div class="card-body">
            {% include 'projects/details/_team_members.html' %}
        </div>
    </div>
{% endblock %}

{% block floating_action %}
{% if can_edit %}
<a href="{{ url_for('projects.edit_project', project_id=project.id) }}" class="btn btn-primary btn-lg floating-action">
    <i class="fas fa-edit me-1"></i> Edit Project
</a>
{% endif %}
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ url_for('projects.static', filename='js/comments.js') }}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Tasks collapse functionality
    const tasksCollapse = document.getElementById('tasks-collapse');
    const tasksCollapseIcon = document.querySelector('.collapse-icon');
    
    tasksCollapse.addEventListener('show.bs.collapse', function() {
        tasksCollapseIcon.classList.remove('fa-plus');
        tasksCollapseIcon.classList.add('fa-minus');
    });
    
    tasksCollapse.addEventListener('hide.bs.collapse', function() {
        tasksCollapseIcon.classList.remove('fa-minus');
        tasksCollapseIcon.classList.add('fa-plus');
    });

    // Todos collapse functionality
    const todosCollapse = document.getElementById('todos-collapse');
    const todosCollapseIcon = document.querySelector('.todos-collapse-icon');
    
    todosCollapse.addEventListener('show.bs.collapse', function() {
        todosCollapseIcon.classList.remove('fa-plus');
        todosCollapseIcon.classList.add('fa-minus');
    });
    
    todosCollapse.addEventListener('hide.bs.collapse', function() {
        todosCollapseIcon.classList.remove('fa-minus');
        todosCollapseIcon.classList.add('fa-plus');
    });
});
</script>
{% endblock %}
