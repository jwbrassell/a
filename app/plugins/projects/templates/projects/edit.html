{% extends 'base.html' %}

{% block title %}{{ project.name }}{% endblock %}

{% block page_content %}
<!-- Title and breadcrumbs -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="m-0">{{ project.name }}</h1>
  <div>
    <ol class="breadcrumb float-sm-right mb-0">
      <li class="breadcrumb-item"><a href="{{ url_for('main.index') }}">Home</a></li>
      <li class="breadcrumb-item"><a href="{{ url_for('projects.list_projects') }}">Projects</a></li>
      <li class="breadcrumb-item active">{{ project.name }}</li>
    </ol>
  </div>
</div>

<div class="row">
  <!-- Left column - Project Details -->
  <div class="col-md-8">
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Project Details</h3>
      </div>
      <div class="card-body">
        <div class="mb-4">
          <i class="{{ project.icon }} fa-3x mb-3"></i>
          <h3>Description</h3>
          <p>{{ project.description }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Right column - Project Info -->
  <div class="col-md-4">
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Project Info</h3>
      </div>
      <div class="card-body">
        <dl class="row">
          <dt class="col-sm-4">Status</dt>
          <dd class="col-sm-8">
            <span class="badge badge-{{ project.status.badge_color }}">{{ project.status.name }}</span>
          </dd>

          <dt class="col-sm-4">Priority</dt>
          <dd class="col-sm-8">
            <span class="badge badge-{{ project.priority.badge_color }}">{{ project.priority.name }}</span>
          </dd>

          <dt class="col-sm-4">Lead</dt>
          <dd class="col-sm-8">{{ project.lead }}</dd>

          <dt class="col-sm-4">Created</dt>
          <dd class="col-sm-8">{{ project.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</dd>

          <dt class="col-sm-4">Updated</dt>
          <dd class="col-sm-8">{{ project.updated_at.strftime('%Y-%m-%d %H:%M:%S') }}</dd>
        </dl>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Team Members</h3>
      </div>
      <div class="card-body p-0">
        <ul class="users-list clearfix">
          {% for member in project.team_members %}
          <li>
            <img src="{{ member.avatar_url }}" alt="User Image">
            <a class="users-list-name" href="#">{{ member.name }}</a>
            <span class="users-list-date">{{ member.role }}</span>
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- Tasks Section -->
<div class="card">
  <div class="card-header">
    <h3 class="card-title">
      <i class="fas fa-tasks mr-1"></i>
      Tasks
    </h3>
    <div class="card-tools">
      <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#modal-new-task">
        <i class="fas fa-plus"></i> Add Task
      </button>
    </div>
  </div>
  <div class="card-body p-0">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Task</th>
          <th>Assigned To</th>
          <th>Status</th>
          <th>Priority</th>
          <th>Due Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for task in project.tasks %}
        <tr>
          <td>{{ task.name }}</td>
          <td>{{ task.assigned_to }}</td>
          <td>
            <span class="badge badge-{{ task.status.badge_color }}">
              {{ task.status.name }}
            </span>
          </td>
          <td>
            <span class="badge badge-{{ task.priority.badge_color }}">
              {{ task.priority.name }}
            </span>
          </td>
          <td>{{ task.due_date.strftime('%Y-%m-%d') if task.due_date }}</td>
          <td>
            <div class="btn-group">
              <button type="button" class="btn btn-default btn-xs" title="View"
                      onclick="viewTask({{ task.id }})">
                <i class="fas fa-eye text-info"></i>
              </button>
              <button type="button" class="btn btn-default btn-xs" title="Edit"
                      onclick="editTask({{ task.id }})">
                <i class="fas fa-pencil-alt text-warning"></i>
              </button>
              <button type="button" class="btn btn-default btn-xs" title="Delete"
                      onclick="deleteTask({{ task.id }})">
                <i class="fas fa-trash text-danger"></i>
              </button>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Todo List Section -->
<div class="card collapsed-card">
  <div class="card-header">
    <h3 class="card-title">
      <i class="ion ion-clipboard mr-1"></i>
      Todo List
    </h3>
    <div class="card-tools">
      <button type="button" class="btn btn-tool" data-card-widget="collapse">
        <i class="fas fa-plus"></i>
      </button>
    </div>
  </div>
  <div class="card-body">
    {% include 'projects/todos/_list.html' with context %}
  </div>
</div>

<!-- Comments Section -->
<div class="card collapsed-card">
  <div class="card-header">
    <h3 class="card-title">
      <i class="fas fa-comments mr-1"></i>
      Comments
    </h3>
    <div class="card-tools">
      <button type="button" class="btn btn-tool" data-card-widget="collapse">
        <i class="fas fa-plus"></i>
      </button>
    </div>
  </div>
  <div class="card-body">
    {% include 'projects/comments/_list.html' with context %}
  </div>
</div>

<!-- Task Modal -->
<div class="modal fade" id="modal-new-task">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">New Task</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="new-task-form">
          <div class="form-group">
            <label for="task-name">Task Name</label>
            <input type="text" class="form-control" id="task-name" required>
          </div>
          <div class="form-group">
            <label for="task-assigned">Assigned To</label>
            <select class="form-control" id="task-assigned" required>
              <option value="">Select User</option>
              {% for member in project.team_members %}
              <option value="{{ member.id }}">{{ member.name }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="form-group">
            <label for="task-status">Status</label>
            <select class="form-control" id="task-status" required>
              <option value="">Select Status</option>
              {% for status in statuses %}
              <option value="{{ status.id }}">{{ status.name }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="form-group">
            <label for="task-priority">Priority</label>
            <select class="form-control" id="task-priority" required>
              <option value="">Select Priority</option>
              {% for priority in priorities %}
              <option value="{{ priority.id }}">{{ priority.name }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="form-group">
            <label for="task-due-date">Due Date</label>
            <input type="date" class="form-control" id="task-due-date" required>
          </div>
        </form>
      </div>
      <div class="modal-footer justify-content-between">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" onclick="saveNewTask()">Save Task</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function viewTask(taskId) {
  // Implement view task logic
  console.log('View task:', taskId);
}

function editTask(taskId) {
  // Implement edit task logic
  console.log('Edit task:', taskId);
}

function deleteTask(taskId) {
  // Implement delete task logic with confirmation
  if (confirm('Are you sure you want to delete this task?')) {
    console.log('Delete task:', taskId);
  }
}

function saveNewTask() {
  // Implement save new task logic
  console.log('Save new task');
  $('#modal-new-task').modal('hide');
}
</script>
{% endblock %}
