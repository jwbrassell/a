<div class="table-responsive">
  <table class="table table-hover align-middle">
    <thead>
      <tr>
        <th style="width: 10px">#</th>
        <th>Description</th>
        <th style="width: 100px">Due</th>
        {% if not readonly %}
        <th style="width: 50px">Actions</th>
        {% endif %}
      </tr>
    </thead>
    <tbody id="todoList">
      {% set todos = task.todos if task is defined else project.todos %}
      {% for todo in todos %}
      <tr data-todo-id="{{ todo.id }}">
        <td>
          <div class="form-check">
            <input type="checkbox" class="form-check-input todo-checkbox" 
                   id="todoCheck{{ todo.id }}" 
                   name="todos[{{ loop.index0 }}][completed]"
                   {% if todo.completed %}checked{% endif %}
                   {% if readonly %}disabled{% endif %}>
            <label class="form-check-label" for="todoCheck{{ todo.id }}"></label>
          </div>
        </td>
        <td>
          {% if readonly %}
          <span class="{% if todo.completed %}text-muted text-decoration-line-through{% endif %}">
            {{ todo.description }}
          </span>
          {% else %}
          <input type="text" class="form-control form-control-sm todo-description {% if todo.completed %}text-muted text-decoration-line-through{% endif %}" 
                 name="todos[{{ loop.index0 }}][description]"
                 value="{{ todo.description }}" required>
          {% endif %}
        </td>
        <td>
          {% if readonly %}
          <span class="badge bg-{{ todo.badge_color }}">
            <i class="far fa-clock"></i> {{ todo.due_text }}
          </span>
          {% else %}
          <input type="date" class="form-control form-control-sm todo-due-date"
                 name="todos[{{ loop.index0 }}][due_date]"
                 value="{{ todo.due_date }}">
          {% endif %}
        </td>
        {% if not readonly %}
        <td>
          <button type="button" class="btn btn-danger btn-sm remove-todo">
            <i class="fas fa-trash"></i>
          </button>
        </td>
        {% endif %}
      </tr>
      {% endfor %}
      {% if (task is defined and task.todos|length == 0) or (project is defined and project.todos|length == 0) %}
      <tr>
        <td colspan="{% if readonly %}3{% else %}4{% endif %}" class="text-center text-muted">
          No todo items found.
        </td>
      </tr>
      {% endif %}
    </tbody>
  </table>
  {% if not readonly %}
  <div class="card-footer text-end">
    <button type="button" class="btn btn-primary btn-sm" id="addTodoBtn">
      <i class="fas fa-plus"></i> Add Todo
    </button>
  </div>
  {% endif %}
</div>

<style>
.table {
  --bs-table-color: var(--bs-body-color);
  --bs-table-bg: var(--bs-body-bg);
  --bs-table-border-color: var(--bs-border-color);
  --bs-table-hover-bg: var(--bs-secondary-bg);
  --bs-table-hover-color: var(--bs-body-color);
}

.form-control {
  background-color: var(--bs-body-bg);
  border-color: var(--bs-border-color);
  color: var(--bs-body-color);
}

.form-control:focus {
  background-color: var(--bs-body-bg);
  border-color: var(--bs-primary);
  color: var(--bs-body-color);
}

.todo-description.text-muted {
  opacity: 0.65;
}
</style>
