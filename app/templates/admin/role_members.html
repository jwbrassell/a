{% extends "base.html" %}

{% block title %}Role Members: {{ role.name }}{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{{ url_for('main.index') }}">Home</a></li>
<li class="breadcrumb-item"><a href="{{ url_for('admin.index') }}">Admin</a></li>
<li class="breadcrumb-item"><a href="{{ url_for('admin.roles') }}">Roles</a></li>
<li class="breadcrumb-item active">{{ role.name }} Members</li>
{% endblock %}

{% block page_content %}
<div class="card">
    <div class="card-header py-3 d-flex justify-content-between align-items-center">
        <h3 class="card-title">
            <i class="fas fa-users mr-2"></i>Members of {{ role.name }}
        </h3>
        <a href="{{ url_for('admin.roles') }}" class="btn btn-secondary btn-sm">
            <i class="fas fa-arrow-left"></i> Back to Roles
        </a>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-bordered" id="membersTable" width="100%" cellspacing="0">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Employee Number</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in role.users %}
                    <tr>
                        <td>{{ user.username }}</td>
                        <td>{{ user.name }}</td>
                        <td>{{ user.email }}</td>
                        <td>{{ user.employee_number }}</td>
                        <td>
                            <form action="{{ url_for('admin.remove_role_member', role_id=role.id, user_id=user.id) }}" method="POST" style="display: inline;">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to remove this user from the role?')">
                                    <i class="fas fa-user-minus"></i> Remove
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Add Member Card -->
<div class="card mt-4">
    <div class="card-header">
        <h3 class="card-title">
            <i class="fas fa-user-plus mr-2"></i>Add Member
        </h3>
    </div>
    <div class="card-body">
        <form action="{{ url_for('admin.add_role_member', role_id=role.id) }}" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="form-group">
                <label for="user_id">Select User</label>
                <select class="form-control select2" id="user_id" name="user_id" required>
                    <option value="">Select a user...</option>
                    {% for user in available_users %}
                    <option value="{{ user.id }}">{{ user.username }} ({{ user.name }})</option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-user-plus"></i> Add to Role
            </button>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    $('#membersTable').DataTable({
        "pageLength": 10,
        "order": [[0, "asc"]],
        "language": {
            "search": "Search members:"
        }
    });

    $('.select2').select2({
        theme: 'bootstrap4',
        placeholder: 'Select a user...',
        width: '100%'
    });
});
</script>
{% endblock %}
